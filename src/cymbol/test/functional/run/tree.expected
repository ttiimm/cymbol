/**
 * Cymbol generated C
 * <Test>
 */

#include <stdio.h>
#include <stdlib.h>
#include <stddef.h>
#include <string.h>

#include "gc.h"

typedef struct Tree {
    TypeDescriptor *type;
    byte *forward;
    struct Tree *left;
    struct Tree *right;
    struct Int *payload;
} Tree;

int Tree_field_offsets[3] = {
    offsetof(Tree, left),
    offsetof(Tree, right),
    offsetof(Tree, payload)
};

TypeDescriptor Tree_type = {
    "Tree",
    sizeof(Tree),
    3,
    Tree_field_offsets
};

Tree *new_Tree() {
    return (Tree *) alloc(&Tree_type);
}

void _main();
Tree *insert(Tree *parent, Tree *in);
void print_inorder(Tree *tree);
void main();

String *_String_literals[1];
Int *_Int_literals[9];

void _main() {
    int i;
    gc_init(256 * 1000);

    _String_literals[0] = new_String("%d ");

    for(i = 0; i < 1; i++)
        ADD_ROOT(_String_literals[i]);

    _Int_literals[0] = new_Int(50);
    _Int_literals[1] = new_Int(60);
    _Int_literals[2] = new_Int(70);
    _Int_literals[3] = new_Int(90);
    _Int_literals[4] = new_Int(80);
    _Int_literals[5] = new_Int(40);
    _Int_literals[6] = new_Int(30);
    _Int_literals[7] = new_Int(10);
    _Int_literals[8] = new_Int(20);

    for(i = 0; i < 9; i++)
        ADD_ROOT(_Int_literals[i]);
}

Tree *insert(Tree *parent, Tree *in) {
    GC_SAVE_RP;
    if(parent == NULL) {
        return in;
    }
     else if(in->payload->value < parent->payload->value) {
        parent->left = insert(parent->left, in);
    }
     else if(in->payload->value > parent->payload->value) {
        parent->right = insert(parent->right, in);
    }

    return parent;
    GC_RESTORE_RP;
}

void print_inorder(Tree *tree) {
    GC_SAVE_RP;
    if(tree == NULL) {
        return;
    }
     else {
        print_inorder(tree->left);
        printf(_String_literals[0]->elements, tree->payload->value);
        print_inorder(tree->right);
    }

    GC_RESTORE_RP;
}

void main() {
    GC_SAVE_RP;
    _main();
    Tree *root = new_Tree();
    ADD_ROOT(root);
    root->payload = _Int_literals[0];
    Tree *sixty = new_Tree();
    ADD_ROOT(sixty);
    sixty->payload = _Int_literals[1];
    Tree *seventy = new_Tree();
    ADD_ROOT(seventy);
    seventy->payload = _Int_literals[2];
    Tree *ninety = new_Tree();
    ADD_ROOT(ninety);
    ninety->payload = _Int_literals[3];
    Tree *eighty = new_Tree();
    ADD_ROOT(eighty);
    eighty->payload = _Int_literals[4];
    Tree *fourty = new_Tree();
    ADD_ROOT(fourty);
    fourty->payload = _Int_literals[5];
    Tree *thirty = new_Tree();
    ADD_ROOT(thirty);
    thirty->payload = _Int_literals[6];
    Tree *ten = new_Tree();
    ADD_ROOT(ten);
    ten->payload = _Int_literals[7];
    Tree *twenty = new_Tree();
    ADD_ROOT(twenty);
    twenty->payload = _Int_literals[8];
    insert(root, sixty);
    insert(root, seventy);
    insert(root, ninety);
    insert(root, eighty);
    insert(root, fourty);
    insert(root, thirty);
    insert(root, ten);
    insert(root, twenty);
    print_inorder(root);
    GC_RESTORE_RP;
}